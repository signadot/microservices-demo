name: 'sandbox-productcatalogsvc'
spec:
  ttl:
    duration: 10w
  labels:
    team: productcatalogservice
    owner: foxish
  description: sandbox env to test a new productcatalogservice
  cluster: foxish-minikube
  resources:
  - name: mariadb
    plugin: productcatalog-mariadb
    params:
      values: |
        {
          "primary": {
            "persistence": {
              "enabled": false
            }
          },
          
          "serviceAccount": {
            "create": false
          },

          "auth": {
            "database": "productcatalogservice",
            "rootPassword": "root"
          },

          "initdbScripts": {
            "backup.sql": "CREATE TABLE `products` (`id` VARCHAR(1024), `name` VARCHAR(1024),`description` VARCHAR(1024),`picture` VARCHAR(1024),`price_usd` JSON,`categories` JSON); 
            
            INSERT INTO `products` VALUES ('16BEE20109','Honeybee Plush','Adorable plush toy that wants to be snuggled like any other fuzzy.','/static/img/products/bee-plush.jpg','{ \"currency_code\": \"USD\", \"units\": 35, \"nanos\": 780000000 }','[\"toy\"]');"
          }
        }
  forks:
  - forkOf:
      kind: Deployment
      name: productcatalogservice
      namespace: shop
    customizations:
      env:
      - name: DB_HOST
        valueFrom:
          resource:
            name: mariadb
            outputKey: provision.host
      - name: DB_PORT
        valueFrom:
          resource:
            name: mariadb
            outputKey: provision.port
  endpoints:
  - name: hotrod-fe
    host: frontend.shop.svc
    port: 80
    protocol: http